<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multijogo EA - Apostas</title>
  <style>
    /* Reset básico */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      color: #f0f0f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .container {
      background-color: #2c2a3a;
      padding: 30px 40px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.4);
      max-width: 480px;
      width: 100%;
      text-align: center;
      transition: transform 0.3s ease;
    }
    .container:hover {
      transform: translateY(-5px);
    }

    h2 {
      font-weight: 700;
      margin-bottom: 25px;
      color: #fff;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-shadow: 0 0 5px #25d366;
    }

    .valoresInput, select {
      width: 100%;
      padding: 12px 15px;
        text-align:center
      margin: 8px 0 20px;
      border: 2px solid #444358;
      border-radius: 8px;
      background-color: #3a3950;
      color: #eee;
      font-size: 1rem;
      transition: border-color 0.25s ease, box-shadow 0.25s ease;
    }

    .valoresInput::placeholder {
      color: #aaaabb;
    }

    .valoresInput:focus, select:focus {
      outline: none;
      border-color: #25d366;
      box-shadow: 0 0 8px #25d366;
      background-color: #2a2a3d;
      color: #fff;
    }

    button {
      background-color: #25d366;
      border: none;
      padding: 14px 0;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #fff;
      cursor: pointer;
      box-shadow: 0 5px 12px rgba(37,211,102,0.6);
      transition: background-color 0.3s ease, box-shadow 0.3s ease;
      width: 100%;
      margin-top: 10px;
      user-select: none;
    }

    button:hover {
      background-color: #1e9e58;
      box-shadow: 0 8px 18px rgba(30,158,88,0.8);
    }

    button:disabled, button[disabled] {
      background-color: #555666;
      cursor: not-allowed;
      box-shadow: none;
    }

    #milharContainer > div,
    #centenaContainer > div,
    #dezenaContainer > div,
    #grupoContainer > div {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
    }

    #milharContainer input,
    #centenaContainer input,
    #dezenaContainer input,
    #grupoContainer input {
      flex: 2;
        text-align:center
    }

    #milharContainer select,
    #centenaContainer select,
    #dezenaContainer select,
    #grupoContainer select {
      flex: 1.2;
      cursor: pointer;
      text-align:center;
    }
    /* Total Pagar / Receber */
    .resultado {
      margin-top: 20px;
      font-size: 1.15rem;
      font-weight: 700;
      color: #ddd;
      line-height: 1.6;
      user-select: none;
    }

    /* Modal Erro */
    #modalErro {
      display: none;
      position: fixed;
      top: 0; left: 0; right:0; bottom: 0;
      background: rgba(0,0,0,0.75);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }

    #modalErro > div {
      background-color: #1e1c2c;
      color: #eee;
      padding: 25px 30px;
      border-radius: 12px;
      max-width: 320px;
      width: 100%;
      text-align: center;
      box-shadow: 0 8px 20px rgba(0,0,0,0.8);
      position: relative;
    }

    #modalErro h3 {
      margin-bottom: 18px;
      font-weight: 800;
      color: #ff4c4c;
      text-shadow: 0 0 6px #ff4c4c;
    }

    #modalErro button {
      width: 100%;
      padding: 12px 0;
      margin-top: 15px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 1rem;
      user-select: none;
      border: none;
      cursor: pointer;
      background-color: #ff4c4c;
      color: white;
      box-shadow: 0 5px 12px rgba(255,76,76,0.7);
    }
    #modalErro button:hover {
      background-color: #cc3b3b;
    }

    #modalErro span {
      position: absolute;
      top: 10px;
      right: 14px;
      font-size: 22px;
      font-weight: 900;
      cursor: pointer;
      color: #ff4c4c;
      user-select: none;
      transition: color 0.2s ease;
    }
    #modalErro span:hover {
      color: #ff0000;
    }

    /* Responsividade */
    @media(max-width: 520px) {
      .container {
        padding: 25px 20px;
      }
      h2 {
        font-size: 1.6rem;
      }
      .resultado {
        font-size: 1rem;
      }
      button, input, select {
        font-size: 1rem;
      }
    }
    input, select, button {
      padding: 5px; margin: 2px 0; width:100%; border-radius: 4px; border: 1px solid #ccc;
    }
    input.numero { width: 100%; box-sizing: border-box; }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDlWGPUuGyugzvvQt_Wd5GI3IBFH90hUgQ",
      authDomain: "multijogo.firebaseapp.com",
      databaseURL: "https://multijogo-default-rtdb.firebaseio.com",
      projectId: "multijogo",
      storageBucket: "multijogo.appspot.com",
      messagingSenderId: "328198585423",
      appId: "1:328198585423:web:ae370bf8e7716ec2f17e3a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const valoresPremio = {
      milhar: 5000, centena: 600, dezena: 70, grupo: 16, duque: 300
    };

    function adicionarCampos(tipo, qtd) {
  const container = document.getElementById(tipo + "Container");
  for (let i = 0; i < qtd; i++) {
    const div = document.createElement("div");
    const input = document.createElement("input");
    input.type = "number";
    input.placeholder = tipo;

    input.oninput = () => {
      if (tipo === "milhar") input.value = input.value.slice(0, 4);
      if (tipo === "centena") input.value = input.value.slice(0, 3);
      if (tipo === "dezena") input.value = input.value.slice(0, 2);
      if (tipo === "grupo") {
        input.value = input.value.slice(0, 2);
        if (parseInt(input.value) > 25) input.value = "25";
      }
      calcularTotal();
    };

    const select = document.createElement("select");
    ["1", "5", "10"].forEach(v => {
      const option = document.createElement("option");
      option.value = v;
      option.textContent = `1º ao ${v}º`;
      select.appendChild(option);
    });

    select.onchange = calcularTotal;

    div.appendChild(input);
    div.appendChild(select);
    container.appendChild(div);
  }
}
    function adicionarCamposDuque() {
  const container = document.getElementById("duqueContainer");
  const div = document.createElement("div");
  const input1 = document.createElement("input");
  const input2 = document.createElement("input");

  input1.type = "number";
  input1.placeholder = "Ex: 22";
  input1.style.width = "40%";
  input1.oninput = () => {
    input1.value = input1.value.slice(0, 2);
    calcularTotal();
  };

  input2.type = "number";
  input2.placeholder = "Ex: 44";
  input2.style.width = "40%";
  input2.oninput = () => {
    input2.value = input2.value.slice(0, 2);
    calcularTotal();
  };

  div.appendChild(input1);
  div.appendChild(document.createTextNode(" x "));
  div.appendChild(input2);
  container.appendChild(div);
}

    function montarTexto(tipo, premio, label) {
  const valorUnit = parseFloat(document.getElementById("valorUnico").value) || 0;
  const container = document.getElementById(tipo + "Container");
  let texto = "";

  container.querySelectorAll("div").forEach(grupo => {
    const input = grupo.querySelector("input");
    const select = grupo.querySelector("select");

    if (input && input.value.trim() !== "") {
      const numero = input.value.trim();
      const pos = select.value;

      let multiplicador = 0;

      if (pos === "1") multiplicador = premio;
      else if (pos === "5") multiplicador = premio / 5;
      else if (pos === "10") multiplicador = premio / 10;

      const valorReceber = valorUnit * multiplicador;

      texto += `${label} ${numero} - R$${valorUnit.toFixed(2)} - 1º ao ${pos}º = R$ ${valorReceber.toFixed(2)}\n`;
    }
  });

  return texto;
}
function calcularTotal() {
  const valorUnitario = parseFloat(document.getElementById("valorUnico").value) || 0;

  let totalPagar = 0;
  let totalReceber = 0;
  const tipos = ['milhar', 'centena', 'dezena', 'grupo'];

  tipos.forEach(tipo => {
    const container = document.getElementById(tipo + 'Container');
    let inputsPreenchidos = 0;

    container.querySelectorAll('input').forEach(input => {
      if (input.value.trim() !== '') {
        inputsPreenchidos++;
      }
    });

    if (inputsPreenchidos > 0) {
      totalPagar += valorUnitario * inputsPreenchidos;

      // valor fixo por tipo (uma vez só)
      if (tipo === 'milhar') totalReceber += 5000;
      if (tipo === 'centena') totalReceber += 600;
      if (tipo === 'dezena') totalReceber += 70;
      if (tipo === 'grupo') totalReceber += 16;
    }
  });

  // Duque especial
  const duqueDivs = document.querySelectorAll('#duqueContainer > div');
  let duquePreenchido = 0;

  duqueDivs.forEach(div => {
    const [i1, i2] = div.querySelectorAll('input');
    if (i1?.value && i2?.value) {
      duquePreenchido++;
    }
  });

  if (duquePreenchido > 0) {
    totalPagar += valorUnitario * duquePreenchido;
    totalReceber += 300; // valor fixo do duque
  }

  document.getElementById("totalPagar").textContent = totalPagar.toFixed(2);
  document.getElementById("totalReceber").textContent = totalReceber.toFixed(2);
}

    function gerarCodigoAposta() {
      return `MJ-${Date.now()}`;
    }

    function abrirModal(msg) {
      document.getElementById("mensagemModal").innerText = msg;
      document.getElementById("modalErro").style.display = "flex";
    }

    function fecharModal() {
      document.getElementById("modalErro").style.display = "none";
    }



let dadosParaSalvar = null;

function enviarWhatsApp() {
  const totalPagar = parseFloat(document.getElementById("totalPagar").textContent) || 0;
  const valorUnico = parseFloat(document.getElementById("valorUnico").value) || 0;
  const horario = document.getElementById("horarioInput").value;
  const codigo = gerarCodigoAposta();

  if (totalPagar <= 0 || valorUnico <= 0) {
    abrirModal("Informe o valor e preencha pelo menos um campo.");
    return;
  }

  let resumo = {};
  let tipos = ["milhar", "centena", "dezena", "grupo"];

  tipos.forEach(tipo => {
    const container = document.getElementById(tipo + "Container");
    container.querySelectorAll("div").forEach(grupo => {
      const input = grupo.querySelector("input");
      const select = grupo.querySelector("select");

      if (input && input.value.trim() !== "") {
        const numero = input.value.trim();
        const posicao = select.value;

        const chave = `${tipo}-${valorUnico}-${posicao}`;
        if (!resumo[chave]) resumo[chave] = [];
        resumo[chave].push(numero);
      }
    });
  });

  let duques = [];
  const duqueContainer = document.getElementById("duqueContainer");
  duqueContainer.querySelectorAll("div").forEach(div => {
    const [i1, i2] = div.querySelectorAll("input");
    if (i1?.value && i2?.value) {
      duques.push(`${i1.value}x${i2.value}`);
    }
  });

  // 🔧 Construir estrutura final
  let firebaseData = {
    codigo,
    horario,
    valorUnico,
    totalPagar,
    totalReceber: parseFloat(document.getElementById("totalReceber").textContent),
    timestamp: Date.now(),
    resumoFormatado: {}
  };

  let textoWhatsApp = `*Código da aposta:* ${codigo}\n`;

  Object.entries(resumo).forEach(([chave, numeros]) => {
    const [tipo, valor, pos] = chave.split("-");
    const rotulo = tipo.charAt(0).toUpperCase() + tipo.slice(1);
    const label = tipo === "grupo"
      ? `${rotulo} do 1° ao ${pos}°`
      : `${rotulo} R$${parseFloat(valor).toFixed(2)} 1° ao ${pos}°`;

    const firebaseKey = label.replace(/[.#$/[\]º°]/g, "").replace(/\s+/g, "_");

    firebaseData.resumoFormatado[firebaseKey] = numeros;
    textoWhatsApp += `\n${label}\n${numeros.join("-")}\n`;
  });

  if (duques.length > 0) {
    firebaseData.resumoFormatado["Duque"] = duques;
    textoWhatsApp += `\nDuque\n${duques.join("\n")}\n`;
  }

  // Exibir modal com resumo formatado
  document.getElementById("resumoTexto").textContent = textoWhatsApp;
  document.getElementById("modalResumo").style.display = "flex";

  // Guardar dados para enviar depois
  dadosParaSalvar = {
    codigo,
    firebaseData,
    textoWhatsApp
  };
}
    window.onload = () => {
  adicionarCampos("milhar", 3);
  adicionarCampos("centena", 3);
  adicionarCampos("dezena", 3);
  adicionarCampos("grupo", 3);
  adicionarCamposDuque();
  bloquearHorariosPassados(); // ✅ Chamar a função ao carregar a página
  calcularTotal();
};
    function bloquearHorariosPassados() {
      const agora = new Date();
      const horaAtual = agora.getHours();
      const minutoAtual = agora.getMinutes();

      const select = document.getElementById("horarioInput");
      let primeiroDisponivel = null;

      Array.from(select.options).forEach(option => {
        const [horaStr, minutoStr] = option.value.split(":");
        const horaOption = parseInt(horaStr);
        const minutoOption = parseInt(minutoStr);

        const minutosOption = horaOption * 60 + minutoOption;
        const minutosAgora = horaAtual * 60 + minutoAtual;

        if (minutosOption <= minutosAgora) {
          option.disabled = true;
          option.textContent += " (Indisponível)";
        } else if (!primeiroDisponivel) {
          primeiroDisponivel = option.value;
        }
      });

      // Selecionar primeiro horário futuro disponível
      if (primeiroDisponivel) {
        select.value = primeiroDisponivel;
      } else {
        select.value = "";
      }
    }
    function fecharResumo() {
  document.getElementById("modalResumo").style.display = "none";
}

function confirmarEnvio() {
  const { codigo, firebaseData } = dadosParaSalvar;

  db.ref(`apostas/${codigo}`).set(firebaseData);

  fecharResumo();
  window.open(`https://wa.me/5571992290058?text=*Código da aposta:* ${codigo}`, "_blank");
}
  </script>
</head>
<body><!-- Modal de Resumo -->
<div id="modalResumo" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center; padding:20px;">
  <div style="background:#2c2a3a; padding:20px; border-radius:10px; max-width:90%; width:400px; color:#fff; text-align:left; box-shadow:0 8px 20px rgba(0,0,0,0.5); position:relative;">
    <span onclick="fecharResumo()" style="position:absolute; top:10px; right:14px; font-size:22px; font-weight:900; cursor:pointer; color:#ff4c4c;">✖</span>
    <h3 style="text-align:center; color:#25d366; margin-bottom:10px;">Resumo da Aposta</h3>
    <pre id="resumoTexto" style="white-space:pre-wrap; font-family:'Segoe UI', sans-serif; font-size:0.95rem; line-height:1.5;"></pre>
    <button onclick="confirmarEnvio()" style="margin-top:10px;">CONFIRMAR ENVIO</button>
  </div>
</div>
  <div class="container">
    <h2>Multijogo</h2>

    <select id="horarioInput" class="valoresInput">
      <option value="10:00">10:00</option>
      <option value="12:00">12:00</option>
      <option value="15:00">15:00</option>
      <option value="19:00">19:00</option>
      <option value="21:00">21:00</option>
    </select>

    <input type="number" id="valorUnico" class="valoresInput" placeholder="Valor único para todos" step="0.01" oninput="calcularTotal()" />

    <div id="milharContainer"></div>
    <button onclick="adicionarCampos('milhar',1)">+ Milhar</button>

    <div id="centenaContainer"></div>
    <button onclick="adicionarCampos('centena',1)">+ Centena</button>

    <div id="dezenaContainer"></div>
    <button onclick="adicionarCampos('dezena',1)">+ Dezena</button>

    <div id="grupoContainer"></div>
    <button onclick="adicionarCampos('grupo',1)">+ Grupo</button>

    <div id="duqueContainer"></div>
    <button onclick="adicionarCamposDuque()">+ Duque</button>

    <div class="resultado">
      Total a Pagar: R$ <span id="totalPagar">0.00</span><br>
      <span>X</span></br>
      Total a Receber: R$ <span id="totalReceber">0.00</span>
    </div>

    <button onclick="enviarWhatsApp()">VALIDAR PULE</button>
  </div>

  <!-- Modal -->
  <div id="modalErro">
    <div>
      <span onclick="fecharModal()">✖</span>
      <h3>Erro</h3>
      <p id="mensagemModal"></p>
      <button onclick="fecharModal()">OK</button>
    </div>
  </div>
</body>
</html>
