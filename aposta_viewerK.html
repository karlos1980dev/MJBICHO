<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Visualizar Aposta</title>
  <style>
    body {
      background: #1f1c2c;
      color: #f0f0f0;
      font-family: Arial, sans-serif;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background-color: #2c2a3a;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
    }
    .resultado {
      margin-top: 25px;
      text-align: left;
      background-color: #1e1c2c;
      padding: 20px;
      border-radius: 10px;
    }
    h3 {
      color: #25d366;
    }
    ul {
      padding-left: 20px;
    }
    li {
      margin-bottom: 5px;
    }
    button {
      margin-top: 20px;
      padding: 10px 20px;
      background: #25d366;
      border: none;
      color: #fff;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #1fa455;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- html2pdf.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDlWGPUuGyugzvvQt_Wd5GI3IBFH90hUgQ",
      authDomain: "multijogo.firebaseapp.com",
      databaseURL: "https://multijogo-default-rtdb.firebaseio.com",
      projectId: "multijogo",
      storageBucket: "multijogo.appspot.com",
      messagingSenderId: "328198585423",
      appId: "1:328198585423:web:ae370bf8e7716ec2f17e3a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let codigoGlobal = '';

    window.onload = function () {
      const params = new URLSearchParams(window.location.search);
      const codigo = params.get("codigo");
      if (codigo) {
        codigoGlobal = codigo;
        buscarApostaPorCodigo(codigo);
      } else {
        document.getElementById("resultado").innerHTML = "<p style='color:red'>‚ùó C√≥digo da aposta n√£o informado na URL.</p>";
      }
    };

    function buscarApostaPorCodigo(codigo) {
      const resultadoDiv = document.getElementById('resultado');
      resultadoDiv.innerHTML = "<p>üîÑ Buscando aposta...</p>";

      db.ref(`apostas/${codigo}`).once('value').then(snapshot => {
        const dados = snapshot.val();
        if (!dados) {
          resultadoDiv.innerHTML = `<p>‚ùå Aposta n√£o encontrada para o c√≥digo: <strong>${codigo}</strong></p>`;
          return;
        }

        let html = `<h3>üéØ Aposta ${codigo}</h3>`;
        if (dados.horario) html += `<p><strong>üïí Hor√°rio:</strong> ${dados.horario}</p>`;
        if (dados.totalPagar !== undefined) html += `<p><strong>üí∞ Total Apostado:</strong> R$ ${Number(dados.totalPagar).toFixed(2)}</p>`;
        if (dados.totalReceber !== undefined) html += `<p><strong>üèÜ Poss√≠vel Retorno:</strong> R$ ${Number(dados.totalReceber).toFixed(2)}</p>`;

        function renderTipo(titulo, array) {
          if (!array || !Array.isArray(array) || array.length === 0) return '';
          let html = `<h4>${titulo}</h4><ul>`;
          array.forEach(item => {
            let linha = "";
            if (item.numero) linha += `${item.numero}`;
            else if (item.numeros) linha += `${item.numeros}`;
            if (item.valor !== undefined) linha += ` - R$ ${Number(item.valor).toFixed(2)}`;
            if (item.posicao) linha += ` (${item.posicao})`;
            if (item.receber) linha += ` ‚Üí Receber R$ ${Number(item.receber).toFixed(2)}`;
            html += `<li>${linha}</li>`;
          });
          html += `</ul>`;
          return html;
        }

        html += renderTipo("üêé Milhar", dados.milhar);
        html += renderTipo("üéØ Centena", dados.centena);
        html += renderTipo("üî¢ Dezena", dados.dezena);
        html += renderTipo("üêò Grupo", dados.grupo);
        html += renderTipo("üí• Duque de Dezena", dados.duque);

        resultadoDiv.innerHTML = html;
        document.getElementById("botaoPDF").style.display = "inline-block";
      }).catch(err => {
        resultadoDiv.innerHTML = `<p style="color:red">‚ö†Ô∏è Erro ao buscar aposta: ${err.message}</p>`;
      });
    }

    function baixarPDF() {
      const elemento = document.getElementById("resultado");
      const opt = {
        margin:       0.5,
        filename:     `Aposta_${codigoGlobal}.pdf`,
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(elemento).save();
    }
  </script>
</head>
<body>
  <div class="container">
    <h2>üìÑ Detalhes da Aposta</h2>
    <div id="resultado" class="resultado"></div>
    <button id="botaoPDF" onclick="baixarPDF()" style="display:none">üì• Baixar PDF</button>
  </div>
</body>
</html>
